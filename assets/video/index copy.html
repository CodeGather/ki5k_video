<!--
 * @Author: 21克的爱情
 * @Date: 2020-06-19 16:54:05
 * @Email: raohong07@163.com
 * @LastEditors: 21克的爱情
 * @LastEditTime: 2020-06-23 10:45:35
 * @Description: 
--> 
<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>视频播放</title>
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
</head>

<body class="markdown-body">
    <div id="app">
        <div id="dplayer"></div>
        <div>
            <h4>选集</h4>
            <div class="video-list">
                <button type="button" v-for="(item, index) in videoPlayList" :key="index" :class="[item.url == currentUrl ? 'btn-info' : 'btn-default', 'btn', 'video-play']" v-on:click="resetPlay(item)">{{item.title}}</button>
            </div>
        </div>
        <div>
            <h4>简介</h4>
            <div class="video-desc">{{videoDesc}}</div>
        </div>
    </div>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/flv.js/dist/flv.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/hls.js/dist/hls.min.js"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/dashjs/dist/dash.all.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/webtorrent/latest/webtorrent.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/npm/pearplayer"></script> -->
    <script src="https://cdn.jsdelivr.net/npm/dplayer@1.26.0/dist/DPlayer.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/stats.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script>
        // function getUrlKey(name) {
        //     var reg = new RegExp('(^|&|\\?)' + name + '=([^&]*)(&|$|\\?)') // 构造一个含有目标参数的正则表达式对象
        //     var r = decodeURIComponent(window.location.href).replace(/\+/g, '%20').match(reg) // 匹配目标参数
        //     if (r != null) return unescape(r[2])
        //     return null // 返回参数值
        // }
        // window.appSendJsData()
        window.App = new Vue({
            el: "#app",
            data() {
                return {
                    videoPlayList: [],
                    videoDesc: "",
                    currentUrl: ""
                }
            },
            mounted() {
                console.log("vue初始化")
                // this.getPlayData()
            },
            methods: {
                getPlayData (data){
                    console.log("接收到参数"+ data)
                    $.ajax({
                        url: "http://movie.ki5k.com/api.php/provide/vod/",
                        data: {
                            'ac': 'detail',
                            'ids': data || 55512,
                            'pg': 1,
                        },
                        type : "GET",
                        success: (data) => {
                            data = JSON.parse(data)
                            let titleData = data.list[0].vod_play_from.split(data.list[0].vod_play_note)
                            let playData = data.list[0].vod_play_url.split(data.list[0].vod_play_note)
                            this.videoPlayList = playData.map((item, i)=>{
                                console.log(titleData[i])
                                return {
                                    title: titleData[i],
                                    url: item.split("$")[1]
                                }
                            })
                            this.currentUrl = playData[1].split("$")[1]
                            this.initPlayers(playData[1].split("$")[1])
                            this.videoDesc = data.list[0].vod_content
                        },
                        error: function(error){
                            console.log(error)
                        }
                    })
                },
                resetPlay (data) {
                    console.log(data.url)
                    if( data.url.indexOf(".mp4") > -1 || data.url.indexOf(".3gp") > -1 || data.url.indexOf(".m3u8") > -1 ||  data.url.indexOf(".avi") > -1 ){
                        this.initPlayers(data.url)
                    } else {
                        // var iframe = document.createElement("iframe");
                        // document.body.appendChild(iframe);
                        // // iframe.style.display = "none";
                        // iframe.style.border = "none";
                        // iframe.src = data.url;
                        // iframe.height = window.innerWidth/iframe.offsetWidth*iframe.offsetHeight;
                        // iframe.width = window.innerWidth;
                        // console.dir(window.innerWidth/iframe.offsetWidth)
                        // $("#dplayer").html(iframe)
                        location.href = data.url;
                    }
                },
                initPlayers (url) {
                    window.dp = new DPlayer({
                        container: document.getElementById('dplayer'),
                        preload: 'none',
                        autoplay: false,
                        theme: '#FADFA3',
                        loop: true,
                        screenshot: true,
                        airplay: true,
                        hotkey: true,
                        volume: 1,
                        mutex: true,
                        video: {
                            url: url || 'https://api.dogecloud.com/player/get.mp4?vcode=5ac682e6f8231991&userId=17&ext=.mp4',
                            pic: 'https://i.loli.net/2019/06/06/5cf8c5d9c57b510947.png',
                            thumbnails: 'https://i.loli.net/2019/06/06/5cf8c5d9cec8510758.jpg',
                            type: 'hls',
                        }
                    });
                    // window.dp.on('playing', function () {
                    //     console.log('player playing');
                    // });
                    // window.dp.on('progress', function (data) {
                    //     console.log(dp);
                    // });
                }
            },
        })
    </script>
</body>

</html>